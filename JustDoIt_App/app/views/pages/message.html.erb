<% i = 0 %>
<% @cars.each do |car|%>
  <% if car.seat_number >= car.passenger.length %>
  <div class="msg_container">
          <div class="pass_bulletin">
            <a class="filter" href="/cars/filter">Filter</a>
            <br>
            <span class="driver">Driver:
              <%= car.user.first_name %>
            </span>
            <br>
            <span class="add_info">Additional Details:
              <%= car.description %>
            </span>
            <br>
            <span class="seats">Seats Available:
              <%= car.seat_number - car.passenger.length %>
            </span>
            <br>
            <span class="meet">Meeting Place:
              <%= car.meeting_point %>
            </span>
            <br>
            <span class="smoke">
              Smoker Friendly:
              <%= car.smoker_friendly%>
            </span>
            <br>
            <span class="date">Date:
              <%= car.date_time.strftime("%d-%B-%Y") %>
            </span>
            <br>
            <span class="time">Time:
              <%= car.date_time.strftime("%I:%M%p") %>
            </span>
            <br>
            <% if current_user.car == nil %>
              <% if current_user.passenger == nil %>
                <a href="/cars/join/<%= car.id %>">Join</a>
              <% else %>
                <% if current_user.passenger.car_id == car.id %>
                  <a href="/cars/unjoin">I change my mind</a>
                <% end %>
              <% end %>
          <% end %>
        </div>
      <% end %>
      <br>
      <p class="curr_distant">You are currently <%= @distances[i] %> KM to meeting point</p>
      <form action="/map" method="get">
        <input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">
        <button class="diff_location">Enter Different Address</button>
      </form>
      <br>
      <% i += 1 %>
    <% end %>

    <a class="return" href="/home">Back</a>

  <div id="map">
    <input id="c_latitude" type="_hidden" name="current_latitude" value="">
    <input id="c_longitude" type="_hidden" name="current_longitude" value="">
  </div>

  </div>

<script>

var lat = document.getElementById("c_latitude");
var lon = document.getElementById("c_longitude");

function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition);
    } else {
        x.innerHTML = "Geolocation is not supported by this browser.";
    }
}

function showPosition(position) {
    lat.value = position.coords.latitude;
    lon.value = position.coords.longitude;
}

getLocation()

</script>



<!-- <% @cars.each do |car| %>
   <%= image_tag "http://maps.google.com/maps/api/staticmap?size=450x300&sensor=false&zoom=16&markers=#{car.latitude}%2C#{car.longitude}"%>
<%end %> -->

<% my_url = "http://maps.google.com/maps/api/staticmap?size=1000x850&sensor=false&zoom=10" %>
<% @cars.each do |car| %>
<% my_url += "&markers=#{car.latitude}%2C#{car.longitude}" %>
<% end %>
<%= image_tag my_url %>
