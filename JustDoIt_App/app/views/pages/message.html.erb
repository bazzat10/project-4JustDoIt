
<a href="/cars/filter">Filter</a>


<% i = 0 %>
<% @cars.each do |car|%>
  <% if car.seat_number >= car.passenger.length %>
      <div>
        <span>Driver:
          <%= car.user.first_name %>
        </span>
        <span>Additional Details:
          <%= car.description %>
        </span>
        <span>No. of Seat Available:
          <%= car.seat_number - car.passenger.length %>
        </span>
        <span>Meeting Place:
          <%= car.meeting_point %>
        </span>
        <span>
          Smoker Friendly:
          <%= car.smoker_friendly%>
        </span>
        <span>Date:
          <%= car.date_time.strftime("%d-%B-%Y") %>
        </span>
        <span>Time:
          <%= car.date_time.strftime("%I:%M%p") %>
        </span>

        <% if current_user.car == nil %>
          <% if current_user.passenger == nil %>
            <a href="/cars/join/<%= car.id %>">I want to join</a>
          <% else %>
            <% if current_user.passenger.car_id == car.id %>
              <a href="/cars/unjoin">I change my mind</a>
            <% end %>
          <% end %>
      <% end %>
    </div>
  <% end %>
  <hr>
  <p>You are currently <%= @distances[i] %> KM to meeting point</p>
  <hr>
  <form action="/map" method="get">
    <input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">
    <input type="hidden" name="meeting_point" value="<%=car.meeting_point%>">
    <input type="hidden" name="suburb" value="<%=car.suburb%>">
    <input type="text" name="user_address" placeholder="Please enter your address" value="">
    <button>Submit</button>
  </form>
  <hr>
  <% i += 1 %>
<% end %>

<a href="/home">Back</a>

<!--
<input id="c_latitude" type="_hidden" name="current_latitude" value="">
<input id="c_longitude" type="_hidden" name="current_longitude" value="">

<script>
var lat = document.getElementById("c_latitude");
var lon = document.getElementById("c_longitude");

function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition);
    } else {
        x.innerHTML = "Geolocation is not supported by this browser.";
    }
}

function showPosition(position) {
    lat.value = position.coords.latitude;
    lon.value = position.coords.longitude;
}

getLocation() -->

<!-- </script> -->

<% my_url = "http://maps.google.com/maps/api/staticmap?size=1000x850&sensor=false&zoom=10" %>
<% @cars.each do |car| %>
<% my_url += "&markers=#{car.latitude}%2C#{car.longitude}" %>
<% end %>
<%= image_tag my_url %>
